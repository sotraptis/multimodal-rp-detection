# dataset_id: e.g., 0=COVID IR, 1=Pneumonia IR, 2=Breathing IR (integers)
from sklearn.metrics import roc_auc_score

unique_sets = np.unique(dataset_id)
for ds in unique_sets:
    tr_idx = np.where(dataset_id != ds)[0]
    te_idx = np.where(dataset_id == ds)[0]
    X_tr, y_tr = X[tr_idx], y[tr_idx]
    X_te, y_te = X[te_idx], y[te_idx]

    # Optional: include dataset indicator as a covariate (one-hot or integer)
    clf = RandomForestClassifier(n_estimators=200, random_state=42)
    clf.fit(X_tr, y_tr)
    y_prob = clf.predict_proba(X_te)[:,1]
    auc = roc_auc_score(y_te, y_prob)
    print(f"LODO held-out IR set {ds}: AUC={auc:.3f} (n={len(te_idx)})")
